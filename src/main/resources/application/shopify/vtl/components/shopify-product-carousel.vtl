#[[
<!-- Shopify Product Grid Web Component -->
<script type="module">
    class ShopifyProductGrid extends HTMLElement {
        constructor() {
            super();
            this.attachShadow({ mode: "open" });
            this.products = [];
        }

        static get observedAttributes() {
            return ['products', 'columns', 'gap'];
        }

        reloadGrid() {
            // Parse new products and re-render
            this.parseProducts();
            this.render();
        }

        // Public method to update products and reload
        updateProducts(newProducts) {
            if (Array.isArray(newProducts)) {
                this.setAttribute('products', JSON.stringify(newProducts));
                this.reloadGrid();
            } else {
                console.error('updateProducts expects an array of products');
            }
        }

        connectedCallback() {
            this.parseProducts();
            this.render();
        }

        disconnectedCallback() {
            // Clean up if needed
        }

        parseProducts() {
            const productsAttr = this.getAttribute('products');

            if (productsAttr) {
                try {
                    this.products = JSON.parse(productsAttr);
                } catch (e) {
                    console.error('Failed to parse products:', e);
                    this.products = [];
                }
            }
        }

        get columns() {
            return parseInt(this.getAttribute('columns')) || 4;
        }

        get gap() {
            return this.getAttribute('gap') || '1.5rem';
        }


        formatPrice(price) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(parseFloat(price));
        }

        truncateText(text, maxLength = 100) {
            if (!text) return '';
            return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
        }

        renderProduct(product, index) {
            const image = product.featuredImage?.url || product.images?.edges?.[0]?.node?.url || '';
            const title = product.title || 'Untitled Product';
            const vendor = product.vendor || '';
            const price = product.priceRange?.minVariantPrice?.amount || '0';
            const description = this.truncateText(product.description || '', 120);
            const productUrl = `/shopify/${product.handle}`;

            return `
                <div class="product-card" data-index="${index}">
                    <div class="product-image-container">
                        <img src="${image}"
                             alt="${title}"
                             class="product-image"
                             onerror="this.onerror=null;this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjBmMGYwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxOCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg==';" />
                        <div class="product-overlay">
                            <a href="${productUrl}"  class="view-product-btn">
                                <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                </svg>
                                View Product
                            </a>
                        </div>
                    </div>
                    <div class="product-info">
                        <h3 class="product-title">${title}</h3>
                        ${vendor ? `<div class="product-vendor">${vendor}</div>` : ''}
                        <div class="product-price">${this.formatPrice(price)}</div>
                        ${description ? `<p class="product-description">${description}</p>` : ''}
                    </div>
                </div>
            `;
        }


        render() {
            if (!this.products.length) {
                this.shadowRoot.innerHTML = `
                    <style>
                        .no-products {
                            text-align: center;
                            padding: 60px 20px;
                            color: #666;
                            font-size: 18px;
                        }
                    </style>
                    <div class="no-products">No products available</div>
                `;
                return;
            }

            this.shadowRoot.innerHTML = `
                <style>
                    * {
                        box-sizing: border-box;
                    }

                    :host {
                        display: block;
                        width: 100%;
                        --primary-color: #2563eb;
                        --secondary-color: #64748b;
                        --border-color: #e2e8f0;
                        --shadow-light: 0 1px 3px rgba(0, 0, 0, 0.1);
                        --shadow-medium: 0 4px 6px rgba(0, 0, 0, 0.1);
                        --shadow-heavy: 0 10px 25px rgba(0, 0, 0, 0.15);
                        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                    }

                    .grid-container {
                        padding: 24px;
                        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
                        border-radius: 16px;
                        box-shadow: var(--shadow-medium);
                    }

                    .products-grid {
                        display: grid;
                        grid-template-columns: repeat(${this.columns}, 1fr);
                        gap: ${this.gap};
                    }

                    .product-card {
                        background: #ffffff;
                        border-radius: 12px;
                        overflow: hidden;
                        box-shadow: var(--shadow-light);
                        transition: var(--transition);
                        height: 100%;
                        display: flex;
                        flex-direction: column;
                        border: 1px solid #f1f5f9;
                    }

                    .product-card:hover {
                        transform: translateY(-4px);
                        box-shadow: var(--shadow-heavy);
                    }

                    .product-image-container {
                        position: relative;
                        width: 100%;
                        height: 240px;
                        overflow: hidden;
                    }

                    .product-image {
                        width: 100%;
                        height: 100%;
                        object-fit: contain;
                        transition: var(--transition);
                    }

                    .product-card:hover .product-image {
                        transform: scale(1.05);
                    }

                    .product-overlay {
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        background: rgba(0, 0, 0, 0.7);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        opacity: 0;
                        transition: var(--transition);
                    }

                    .product-card:hover .product-overlay {
                        opacity: 1;
                    }

                    .view-product-btn {
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        padding: 12px 20px;
                        background: var(--primary-color);
                        color: white;
                        text-decoration: none;
                        border-radius: 8px;
                        font-weight: 600;
                        font-size: 14px;
                        transition: var(--transition);
                        transform: translateY(10px);
                    }

                    .product-card:hover .view-product-btn {
                        transform: translateY(0);
                    }

                    .view-product-btn:hover {
                        background: #1d4ed8;
                        transform: scale(1.05);
                    }

                    .product-info {
                        padding: 20px;
                        flex: 1;
                        display: flex;
                        flex-direction: column;
                    }

                    .product-title {
                        font-size: 18px;
                        font-weight: 700;
                        color: #1e293b;
                        margin: 0 0 8px 0;
                        line-height: 1.4;
                        display: -webkit-box;
                        -webkit-line-clamp: 2;
                        -webkit-box-orient: vertical;
                        overflow: hidden;
                    }

                    .product-vendor {
                        font-size: 14px;
                        color: var(--secondary-color);
                        margin-bottom: 8px;
                        font-weight: 500;
                    }

                    .product-price {
                        font-size: 20px;
                        font-weight: 700;
                        color: var(--primary-color);
                        margin-bottom: 12px;
                    }

                    .product-description {
                        font-size: 14px;
                        color: #64748b;
                        line-height: 1.5;
                        margin: 0;
                        flex: 1;
                        display: -webkit-box;
                        -webkit-line-clamp: 3;
                        -webkit-box-orient: vertical;
                        overflow: hidden;
                    }


                    /* Responsive Design */
                    @media (max-width: 1200px) {
                        .products-grid {
                            grid-template-columns: repeat(3, 1fr);
                        }
                    }

                    @media (max-width: 768px) {
                        .grid-container {
                            padding: 16px;
                        }

                        .products-grid {
                            grid-template-columns: repeat(2, 1fr);
                            gap: 1rem;
                        }

                        .product-image-container {
                            height: 200px;
                        }

                        .product-info {
                            padding: 16px;
                        }

                        .product-title {
                            font-size: 16px;
                        }

                        .product-price {
                            font-size: 18px;
                        }
                    }

                    @media (max-width: 480px) {
                        .products-grid {
                            grid-template-columns: 1fr;
                        }

                        .grid-container {
                            padding: 12px;
                        }
                    }
                </style>

                <div class="grid-container">
                    <div class="products-grid">
                        ${this.products.map((product, index) => this.renderProduct(product, index)).join('')}
                    </div>
                </div>
            `;
        }

        attributeChangedCallback(name, oldValue, newValue) {
            if (oldValue !== newValue) {
                if (name === 'products') {
                    this.parseProducts();
                }
                this.render();
            }
        }
    }

    customElements.define('shopify-product-grid', ShopifyProductGrid);
</script>
]]#
